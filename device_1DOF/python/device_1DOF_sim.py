import numpy as np
from math import sin, cos, radians, degrees


def ff_func(X):
    global m_d_u, m_d_f, m_h_u, m_h_f, g, q_u_0, q_f_0, K_u, K_f, K_t_u, K_t_f 
    global L_d_u, L_d_f, L_h_u, L_h_f, l_s_u_0, l_s_f_0, d_d, h_d, G_h_u, G_h_f, G_d_u, G_d_f
    global baselink_angle 

    q_u = X[0]
    q_f = X[1]

    # matlab
    #f1 = (conj(K_t_u)*(2*conj(q_u) - 2*conj(q_u_0)))/2 - conj(K_f)*((cos(conj(q_u))*conj(L_d_u) + cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) - conj(L_d_f)*cos(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2)*(conj(l_s_f_0) - (sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(K_u)*((cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2 - (cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)))*(conj(l_s_u_0) - (sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(g)*conj(m_h_f)*((cos(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*cos(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2) + conj(g)*conj(m_h_u)*((cos(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*cos(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) + cos(conj(baselink_angle) + conj(q_u))*conj(G_h_u)*conj(L_h_u) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2);
    #f2 = (conj(K_t_f)*(2*conj(q_f) - 2*conj(q_f_0)))/2 - conj(K_u)*((cos(conj(q_f))*conj(L_d_f) + cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) - conj(L_d_u)*cos(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2)*(conj(l_s_u_0) - (sin(conj(q_f))*conj(L_d_f) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_u) + conj(L_d_u)*sin(conj(d_d) - conj(q_f)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(K_f)*((cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u))))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2 - (cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f))/sin(conj(q_f) - conj(d_d) + conj(q_u)))*(conj(l_s_f_0) - (sin(conj(q_u))*conj(L_d_u) + sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_h_f) + conj(L_d_f)*sin(conj(d_d) - conj(q_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))) + conj(g)*conj(m_h_u)*((cos(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) - sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*cos(conj(d_d) - conj(q_f)) + sin(conj(baselink_angle))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) - (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2) - conj(g)*conj(m_h_f)*(cos(conj(baselink_angle) + conj(d_d) - conj(q_f))*conj(G_h_f)*conj(L_h_f) - (cos(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) - sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*cos(conj(d_d) - conj(q_f)) + sin(conj(baselink_angle))*cos(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u))/sin(conj(q_f) - conj(d_d) + conj(q_u)) + (cos(conj(q_f) - conj(d_d) + conj(q_u))*(sin(conj(baselink_angle) + conj(q_u))*conj(L_d_u)*sin(conj(d_d) - conj(q_f)) + sin(conj(q_f))*sin(conj(baselink_angle) + conj(q_u))*conj(L_d_f) + sin(conj(baselink_angle))*sin(conj(q_f) - conj(d_d) + conj(q_u))*conj(L_d_u)))/sin(conj(q_f) - conj(d_d) + conj(q_u))^2);

    f1 = (np.conj(K_t_u)*(2*np.conj(q_u) - 2*np.conj(q_u_0)))/2 - np.conj(K_f)*((cos(np.conj(q_u))*np.conj(L_d_u) + cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f) - np.conj(L_d_f)*cos(np.conj(d_d) - np.conj(q_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(q_u))*np.conj(L_d_u) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f) + np.conj(L_d_f)*sin(np.conj(d_d) - np.conj(q_u))))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2)*(np.conj(l_s_f_0) - (sin(np.conj(q_u))*np.conj(L_d_u) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f) + np.conj(L_d_f)*sin(np.conj(d_d) - np.conj(q_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))) + np.conj(K_u)*((cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(q_f))*np.conj(L_d_f) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u) + np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f))))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2 - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)))*(np.conj(l_s_u_0) - (sin(np.conj(q_f))*np.conj(L_d_f) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u) + np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))) + np.conj(g)*np.conj(m_h_f)*((cos(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*cos(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2) + np.conj(g)*np.conj(m_h_u)*((cos(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*cos(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) + cos(np.conj(baselink_angle) + np.conj(q_u))*np.conj(G_h_u)*np.conj(L_h_u) - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2)
    f2 = (np.conj(K_t_f)*(2*np.conj(q_f) - 2*np.conj(q_f_0)))/2 - np.conj(K_u)*((cos(np.conj(q_f))*np.conj(L_d_f) + cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u) - np.conj(L_d_u)*cos(np.conj(d_d) - np.conj(q_f)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(q_f))*np.conj(L_d_f) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u) + np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f))))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2)*(np.conj(l_s_u_0) - (sin(np.conj(q_f))*np.conj(L_d_f) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_u) + np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))) + np.conj(K_f)*((cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(q_u))*np.conj(L_d_u) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f) + np.conj(L_d_f)*sin(np.conj(d_d) - np.conj(q_u))))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2 - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)))*(np.conj(l_s_f_0) - (sin(np.conj(q_u))*np.conj(L_d_u) + sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_h_f) + np.conj(L_d_f)*sin(np.conj(d_d) - np.conj(q_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))) + np.conj(g)*np.conj(m_h_u)*((cos(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) - sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*cos(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(baselink_angle))*cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) - (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2) - np.conj(g)*np.conj(m_h_f)*(cos(np.conj(baselink_angle) + np.conj(d_d) - np.conj(q_f))*np.conj(G_h_f)*np.conj(L_h_f) - (cos(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) - sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*cos(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(baselink_angle))*cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u)) + (cos(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*(sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_u)*sin(np.conj(d_d) - np.conj(q_f)) + sin(np.conj(q_f))*sin(np.conj(baselink_angle) + np.conj(q_u))*np.conj(L_d_f) + sin(np.conj(baselink_angle))*sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))*np.conj(L_d_u)))/sin(np.conj(q_f) - np.conj(d_d) + np.conj(q_u))**2)

    F = [f1, f2]
    #print(F)
    return np.array(F)


def jj_func(X):
    global m_d_u, m_d_f, m_h_u, m_h_f, g, q_u_0, q_f_0, K_u, K_f, K_t_u, K_t_f 
    global L_d_u, L_d_f, L_h_u, L_h_f, l_s_u_0, l_s_f_0, d_d, h_d, G_h_u, G_h_f, G_d_u, G_d_f
    global baselink_angle 

    q_u=X[0]
    q_f=X[1]

    # matlab
    #j11 = K_t_u + K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2)^2 + K_u*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))^2 + K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (2*L_h_u*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^3) - g*m_h_u*((2*cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + G_h_u*L_h_u*sin(baselink_angle + q_u) - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) - g*m_h_f*((2*cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) + K_f*((2*cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^3)*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u));
    #j12 = K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)^2 + (L_h_u*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^3) - g*m_h_u*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) - g*m_h_f*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)^2 + (L_h_f*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^3) - K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2)*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u)) - K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2)*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u));
    #j21 = K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)^2 + (L_h_u*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^3) - g*m_h_u*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) - g*m_h_f*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)^2 + (L_h_f*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^3) - K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2)*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u)) - K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2)*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u));
    #j22 = K_t_f + K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^2)^2 + K_f*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))^2 - g*m_h_f*((2*cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 + G_h_f*L_h_f*sin(baselink_angle + d_d - q_f) - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (2*L_h_f*cos(q_f - d_d + q_u)^2)/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)^3) - g*m_h_u*((2*cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)^3) + K_u*((2*cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)^2 - (2*cos(q_f - d_d + q_u)^2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)^3)*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u));

    j11 = K_t_u + K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2)**2 + K_u*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))**2 + K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (2*L_h_u*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**3) - g*m_h_u*((2*cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + G_h_u*L_h_u*sin(baselink_angle + q_u) - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) - g*m_h_f*((2*cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) + K_f*((2*cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**3)*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))
    j12 = K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)**2 + (L_h_u*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**3) - g*m_h_u*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) - g*m_h_f*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)**2 + (L_h_f*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**3) - K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2)*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u)) - K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2)*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))
    j21 = K_u*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))*(L_h_u - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)**2 + (L_h_u*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**3) - g*m_h_u*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) - g*m_h_f*((L_d_u*cos(baselink_angle + q_u)*cos(d_d - q_f) - L_d_f*cos(baselink_angle + q_u)*cos(q_f) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) - (L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_d_f*cos(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*cos(baselink_angle + q_u) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + (cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (cos(q_f - d_d + q_u)*(L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u)))/sin(q_f - d_d + q_u)**2 + (L_h_f*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**3) - K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2)*((cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2 - (L_h_u*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u)) - K_f*((L_h_f*cos(q_f - d_d + q_u) + L_d_u*cos(q_u) - L_d_f*cos(d_d - q_u))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2)*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))
    j22 = K_t_f + K_u*((L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f))/sin(q_f - d_d + q_u) - (cos(q_f - d_d + q_u)*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**2)**2 + K_f*((cos(q_f - d_d + q_u)*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**2 - (L_h_f*cos(q_f - d_d + q_u))/sin(q_f - d_d + q_u))**2 - g*m_h_f*((2*cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 + G_h_f*L_h_f*sin(baselink_angle + d_d - q_f) - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) + K_f*(l_s_f_0 - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u))*(L_h_f - (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u) + (2*L_h_f*cos(q_f - d_d + q_u)**2)/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u)))/sin(q_f - d_d + q_u)**3) - g*m_h_u*((2*cos(q_f - d_d + q_u)*(L_d_f*sin(baselink_angle + q_u)*cos(q_f) - L_d_u*sin(baselink_angle + q_u)*cos(d_d - q_f) + L_d_u*cos(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_d_f*sin(baselink_angle + q_u)*sin(q_f) + L_d_u*sin(d_d - q_f)*sin(baselink_angle + q_u) + L_d_u*sin(q_f - d_d + q_u)*sin(baselink_angle)))/sin(q_f - d_d + q_u)**3) + K_u*((2*cos(q_f - d_d + q_u)*(L_h_u*cos(q_f - d_d + q_u) + L_d_f*cos(q_f) - L_d_u*cos(d_d - q_f)))/sin(q_f - d_d + q_u)**2 - (2*cos(q_f - d_d + q_u)**2*(L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f)))/sin(q_f - d_d + q_u)**3)*(l_s_u_0 - (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u))

    J = [[j11, j12], [j21, j22]]
    #print(J)
    return np.array(J)


# INPUT

interval = 1 #[deg]

minimum_elbow_angle = 30 #[deg] ex) 0 45 90 180
maximum_elbow_angle = 180 #[deg] 


# 

B = np.arange(0, 360 + interval, interval) # baselink 
E = np.arange(minimum_elbow_angle, maximum_elbow_angle + interval, interval)
NE = np.where(E == 180)[0] # singularity
E = np.delete(E, NE) # elbow angle - delite 180deg

d_d = np.radians(minimum_elbow_angle)


# constant value 73kg, 1741mm, male

L_h_u = 0.2817 # human upper arm length[m]
L_h_f = 0.2689 # human forearm length[m]
L_d_u = 0.2 # device upper arm length[m]
L_d_f = 0.2 # device forarm length[m]

m_h_u = 1.9783 # human upper arm weight[kg]
m_h_f = 1.1826 # human forearm weight[kg]
m_d_u = 2 # device upper arm weight[kg]
m_d_f = 2 # device forearm weight[kg]

G_h_u = 0.4228 # human upper arm gravity ratio
G_h_f = 0.4574 # human forearm gravity ratio
G_d_u = 0.5 # robot upper arm gravity ratio
G_d_f = 0.5 # robot forearm gravity ratio

K_u = 10000 # human upper arm shear stiffness[N/m]
K_f = 10000 # human forearm shear stiffness[N/m]
K_t_u = 10000 # human upper arm torsion stiffness[N/m]
K_t_f = 10000 # human forearm torsion stiffness[N/m]
q_u_0 = 0 # initial value of human upper arm deg[deg]
q_f_0 = 0 # initial value of human forearm deg[deg]

g = 9.81 # gravitational acceleration[m/s^2]


# initial value of spring length
    
l_s_u_0 = L_h_u - L_d_u # initial value of human upper arm spring[m] 
l_s_f_0 = L_h_f - L_d_f # initial value of human forearm srping[m]


# Newton-Raphson method 

ID= open("result.txt","w+") # creat result text file 

for n in B:
    X = [radians(0.1), radians(0.1)] # initial value
    baselink_angle = radians(n)

    for m in E:
        d_d = radians(m)
        i = 0
        err = max(np.abs(ff_func(X)))
        tol = 1e-4        
    
        while err > tol:
            i += 1
            X1 = X - np.linalg.inv(jj_func(X)).dot(ff_func(X))
            X = X1
            err = max(np.abs(ff_func(X)))
            print(f'i: {i}, error:{err}')

        q_u, q_f = X
        l_s_u = (L_h_u*sin(q_f - d_d + q_u) + L_d_f*sin(q_f) + L_d_u*sin(d_d - q_f))/sin(q_f - d_d + q_u)
        l_s_f = (L_h_f*sin(q_f - d_d + q_u) + L_d_u*sin(q_u) + L_d_f*sin(d_d - q_u))/sin(q_f - d_d + q_u)
        h_d = d_d - q_u - q_f
        
        deg_baselink_angle = round(degrees(baselink_angle),4)
        deg_device = round(degrees(d_d),4)
        deg_human = round(degrees(h_d),4)
        deg_q_u = round(degrees(q_u),4)
        deg_q_f = round(degrees(q_f),4)
        mm_def_l_s_u = round(1000 * (l_s_u - l_s_u_0) , 4)
        mm_def_l_s_f = round(1000 * (l_s_f - l_s_f_0) , 4)

        ID.write(f'{deg_baselink_angle} {deg_device} {deg_human} {deg_q_u} {deg_q_f} {mm_def_l_s_u} {mm_def_l_s_f}\n')

ID.closed()